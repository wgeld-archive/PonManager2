@page "/pontag"
@using TestClientServer.Shared.Models
@inject HttpClient Http
@inject NavigationManager NavigationManager

<PageTitle>PonLightUp </PageTitle>

<h1>Input PON Information</h1>

<EditForm Model="@_currentEntry" OnValidSubmit="ShowConfirmationModal">
    <DataAnnotationsValidator/>
    <ValidationSummary/>
    <div class="form-group">
        <label for="olt">OLT:</label>
        <InputNumber id="olt" @bind-Value="_currentEntry.Olt" class="form-control" />
    </div>
    <div class="form-group">
        <label for="lt">LT:</label>
        <InputNumber id="lt" @bind-Value="_currentEntry.Lt" class="form-control" />
    </div>
    <div class="form-group">
        <label for="pon">PON:</label>
        <InputNumber id="pon" @bind-Value="_currentEntry.Pon" class="form-control" />
    </div>
    <div class="form-group">
        <label for="fsa">FSA:</label>
        <InputText id="fsa" @bind-Value="_currentEntry.Fsa" class="form-control" />
    </div>
    <div class="form-group">
        <label for="splitter">Splitter:</label>
        <InputText id="splitter" @bind-Value="_currentEntry.Splitter" class="form-control" />
    </div>
    <div class="form-group">
        <label for="town">Town:</label>
        <InputText id="town" @bind-Value="_currentEntry.Town" class="form-control" />
    </div>
    <div class ="mt-3">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
</EditForm>

@if (_showConfirmationModal)
{
<div class="modal" tabindex="-1" style="display:block; background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Submission</h5>
                <button type="button" class="close" @onclick="() => _showConfirmationModal = false">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Olt: @_currentEntry.Olt</p>
                <p>Lt: @_currentEntry.Lt</p>
                <p>Pon: @_currentEntry.Pon</p>
                <p>Fsa: @_currentEntry.Fsa</p>
                <p>Splitter: @_currentEntry.Splitter</p>
                <p>Town: @_currentEntry.Town</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" @onclick="() => _showConfirmationModal = false">Cancel</button>
                <button class="btn btn-primary" @onclick="ConfirmAndSubmit">Confirm and Submit</button>
            </div>
        </div>
    </div>
</div>
}


@code {
    private readonly FormData _currentEntry = new();
    private bool _showConfirmationModal = false;

    private void   ShowConfirmationModal()
    {
        _showConfirmationModal = true;
    }
    
    private async Task ConfirmAndSubmit()
    {
        _showConfirmationModal = false;
        var url = $"formdata?olt={_currentEntry.Olt}&lt={_currentEntry.Lt}&pon={_currentEntry.Pon}&town={_currentEntry.Town}&fdh={_currentEntry.Fsa}&splitter={_currentEntry.Splitter}";
        var response = await Http.PostAsync(url, null); 
        if (response.IsSuccessStatusCode)
        {
            NavigationManager.NavigateTo("/confirmation");
        }
        else
        {
            NavigationManager.NavigateTo("/error");
        }
    }
}